<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Valentine's Special - Music & Lyrics</title>
    <link rel="shortcut icon" href="images/gift.png" type="image/x-icon">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
    <style>
        /* Global Styles */
        body {
            background: linear-gradient(270deg, #ff6b81, #a65eaa);
            background-size: 400% 400%;
            animation: gradientAnimation 15s ease infinite;
            overflow: hidden; /* Prevent scrollbars */
            height: 100vh; /* Full viewport height */
            margin: 0;
            font-family: Arial, sans-serif;
            display: flex; /* Use flexbox for centering */
            justify-content: center; /* Center horizontally */
            align-items: center; /* Center vertically */
            position: relative; /* For absolute position elements */
        }

        @keyframes gradientAnimation {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }

        /* Rain Image Styles */
        .rain {
            position: absolute;
            top: -100px;
            width: 100%;
            pointer-events: none; /* Prevent interactions */
            display: none; /* Initially hidden */
        }

        .rain img {
            position: absolute; /* Allow random positioning */
            width: 100px; /* Make images larger */
            animation: fall linear infinite; /* Animate falling */
        }

        @keyframes fall {
            0% { transform: translateY(0); }
            100% { transform: translateY(100vh); }
        }

        /* Sparkle Effect */
        .sparkle {
            position: absolute;
            background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0) 70%);
            border-radius: 50%;
            animation: sparkleAnimation 1.5s infinite ease-in-out;
            pointer-events: none;
            opacity: 0;
        }

        @keyframes sparkleAnimation {
            0% { transform: scale(0); opacity: 0.6; }
            50% { opacity: 0.4; }
            100% { transform: scale(1); opacity: 0; }
        }

        /* Envelope Styles */
        .envelope {
            width: 400px;
            height: 250px;
            perspective: 1000px;
            cursor: pointer;
            margin: 0; 
            z-index: 2; 
            transition: transform 0.2s; /* Added hover effect */
        }

        .envelope:hover {
            transform: scale(1.05); /* Slightly enlarge on hover */
        }

        .envelope-inner {
            width: 100%;
            height: 100%;
            background-color: #ffffff; 
            border-radius: 10px;
            position: relative;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        .envelope-flap {
            position: absolute;
            width: 100%;
            height: 50%;
            background-color: #ff6b81;
            clip-path: polygon(0 0, 100% 0, 50% 100%);
            top: 0; 
            left: 0;
            transition: transform 0.6s; 
            transform-origin: top;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            z-index: 1; 
        }

        .envelope.open .envelope-flap {
            transform: rotateX(-60deg); 
            z-index: 0; 
        }

        .envelope.open .envelope-inner {
            transform: rotateY(0deg);
        }

        /* Letter Styles */
        .letter {
            width: 400px; 
            height: 50vh; 
            background-color: #ffffff; 
            border: 2px solid #ff6b81;
            border-radius: 10px;
            position: absolute;
            bottom: -300px; 
            left: 50%;
            transform: translateX(-50%);
            padding: 20px; 
            opacity: 0; 
            transition: bottom 0.5s ease, opacity 0.5s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            justify-content: flex-start; 
            align-items: center;
        }

        .letter-content {
            width: 100%; 
            text-align: center;
        }

        .letter-content h2 {
            margin: 0;
            font-size: 28px; 
        }

        .letter-content p {
            margin: 5px 0;
            font-size: 20px; 
        }

        /* Lyrics Styles */
        .lyrics {
            display: none; 
            text-align: center; 
            margin-top: 10px;
            width: 100%; 
        }

        .lyric {
            display: none;
            margin: 10px 0; 
            font-size: 20px; 
            transition: opacity 0.5s ease; 
        }

        /* Falling image styles */
        .falling-image {
            position: fixed; /* Changed to fixed */
            top: 50%; /* Center vertically */
            left: 50%; /* Center horizontally */
            transform: translate(-50%, -50%); /* Centering fix */
            z-index: 3; /* Be above everything */
            visibility: hidden; /* Hidden by default */
        }
    </style>
</head>
<body>
    <!-- Sparkles -->
    <div class="sparkle" id="sparkles"></div>

    <!-- Rain Images -->
    <div class="rain" id="rainContainer">
        <!-- Use heart-shaped images or glittery images -->
        <%= image_tag '1.jpeg', alt: 'Image 1' %>
        <%= image_tag '2.jpeg', alt: 'Image 2' %>
        <%= image_tag '3.jpeg', alt: 'Image 3' %>
        <%= image_tag '4.jpeg', alt: 'Image 4' %>
        <%= image_tag '5.jpeg', alt: 'Image 5' %>
        <%= image_tag '6.jpeg', alt: 'Image 6' %>
        <%= image_tag '7.jpeg', alt: 'Image 7' %>
        <%= image_tag '8.jpeg', alt: 'Image 8' %>
        <%= image_tag '9.jpeg', alt: 'Image 9' %>
        <%= image_tag '10.jpeg', alt: 'Image 10' %>
        <%= image_tag '11.jpeg', alt: 'Image 11' %>
        <%= image_tag '12.jpeg', alt: 'Image 12' %>
        <%= image_tag '13.jpeg', alt: 'Image 13' %>
        <%= image_tag '14.jpeg', alt: 'Image 14' %>
        <%= image_tag '15.jpeg', alt: 'Image 15' %>
        <%= image_tag '16.jpeg', alt: 'Image 16' %>
    </div>

    <!-- Main Content -->
    <div class="envelope" onclick="openEnvelope(this)">
        <div class="envelope-inner">
            <div class="envelope-flap"></div>
            <div class="letter" id="letter">
                <div class="letter-content">
                    <h2>Special Valentine's Gift</h2>
                    <p>Enjoy the music and lyrics just for you! ðŸ’–</p>
                    <audio id="song" controls onplay="startShowingLyrics(); startRain(); startConfetti();" onpause="stopRain()">
                        <source src="<%= asset_path('radwimps_yumetourou.mp3') %>" type="audio/mpeg">
                        Your browser does not support the audio element.
                    </audio>
                    <div class="lyrics" id="lyrics">
                        <p>ðŸŽµ Yumetourou - Radwimps ðŸŽµ</p>
                        <div class="lyric" id="lyric-1">Hello hon</div>
                        <div class="lyric" id="lyric-2">Been wondering what am I doing?</div>
                        <div class="lyric" id="lyric-3">Well I've been working with this</div>
                        <div class="lyric" id="lyric-4">Dedicated to the one</div>
                        <div class="lyric" id="lyric-5">And only</div>
                        <div class="lyric" id="lyric-6">Girl of my life</div>
                        <div class="lyric" id="lyric-7">In</div>
                        <div class="lyric" id="lyric-8">3</div>
                        <div class="lyric" id="lyric-9">2</div>
                        <div class="lyric" id="lyric-10">1</div>
                        <div class="lyric" id="lyric-11">Aa kono mama bokutachi no koe ga</div>
                        <div class="lyric" id="lyric-12">Sekai no hajikko made kieru koto naku</div>
                        <div class="lyric" id="lyric-13">Todoitari shitara ii nonina</div>
                        <div class="lyric" id="lyric-14">Soshitara nee futari de donna kotoba wo hanatou</div>
                        <div class="lyric" id="lyric-15">Kieru koto nai yakusoku wo futari de "se-no" de iou</div>
                        <div class="lyric" id="lyric-16">Ohh</div>
                        <div class="lyric" id="lyric-17">Aa "negattara nanigashika ga kanau"</div>
                        <div class="lyric" id="lyric-18">Sono kotoba no me wo mou mirenakunatta no wa</div>
                        <div class="lyric" id="lyric-19">Ittai itsu kara darou ka naniyue darou ka</div>
                        <div class="lyric" id="lyric-20">Aa ame no yamu masa ni sono kirema to</div>
                        <div class="lyric" id="lyric-21">Niji no shuppatsuten shuuten to</div>
                        <div class="lyric" id="lyric-22">Kono inochi hateru basho ni nanika ga aru tte itsumo iihatteita</div>
                        <div class="lyric" id="lyric-23">Itsuka ikou zenseimei mo mitou mikaitaku</div>
                        <div class="lyric" id="lyric-24">Kanjou ni haitacchi shite jikan ni kisu wo</div>
                        <div class="lyric" id="lyric-25">Gojigen ni karakawarete</div>
                        <div class="lyric" id="lyric-26">Soredemo kimi wo miru yo</div>
                        <div class="lyric" id="lyric-27">Mata "hajimemashite" no aizu wo kimeyou</div>
                        <div class="lyric" id="lyric-28">Kimi no na wo ima oikakeru yo</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Falling Image -->
    <script>
        let rainStarted = false; // To track if rain has started
        let confettiActive = false; // To track confetti
        const fallingImage = document.getElementById("fallingImage");

        document.addEventListener("DOMContentLoaded", function() {
            const rainImages = document.querySelectorAll('.rain img');

            // Function to start the rain animation on button press
            function startRain() {
                const rainContainer = document.getElementById("rainContainer");
                rainContainer.style.display = "block"; // Show the rain container

                if (!rainStarted) {
                    rainImages.forEach((img) => {
                        // Randomize position
                        const randomX = Math.random() < 0.5 ? Math.random() * 50 : 100 - (Math.random() * 50);
                        const fallDuration = 5 + Math.random() * 3; // Randomize fall speed

                        img.style.left = `${randomX}vw`;
                        img.style.animationDuration = `${fallDuration}s`; 
                        img.style.animationDelay = `${Math.random()}s`; 
                        img.style.top = `-${Math.random() * 100}px`; 
                        img.classList.add('fall'); // Add animation class for falling effect
                    });
                    rainStarted = true; // Update the status to indicate rain is active
                }
            }

            // Function to stop the rain animation
            function stopRain() {
                document.getElementById("rainContainer").style.display = "none"; 
                rainStarted = false; 
            }

            function startConfetti() {
                if (!confettiActive) {
                    confettiActive = true;
                    // This function creates a colorful confetti effect
                    for (let i = 0; i < 100; i++) {
                        const confetti = document.createElement('div');
                        confetti.classList.add('sparkle');
                        confetti.style.width = Math.random() * 5 + 'px';
                        confetti.style.height = confetti.style.width;
                        confetti.style.left = Math.random() * 100 + 'vw';
                        confetti.style.animationDuration = (Math.random() * 3 + 2) + 's';
                        document.body.appendChild(confetti);
                        setTimeout(() => confetti.remove(), 3000); // Remove after a few seconds
                    }
                }
            }

            // Listen for when the song is played or paused
            document.getElementById("song").addEventListener('play', function() {
                startRain();
                startConfetti();
                fallingImage.style.visibility = "visible"; // Make the falling image visible
                
            });
            document.getElementById("song").addEventListener('pause', stopRain);
            document.getElementById("song").addEventListener('ended', function() {
                fallingImage.style.visibility = "hidden"; // Hide the falling image when the song ends
            });
        });

        function openEnvelope(envelope) {
            envelope.classList.toggle('open');
            const letter = document.getElementById('letter');
            if (envelope.classList.contains('open')) {
                letter.style.bottom = '0'; // Slide the letter up
                letter.style.opacity = '1'; // Show the letter
            } else {
                letter.style.bottom = '-300px'; 
                letter.style.opacity = '0'; 
                clearLyrics(); // Clear any shown lyrics when closing
            }
        }

        function startShowingLyrics() {
            document.getElementById('lyrics').style.display = 'block'; 
            showTimedLyrics(); 
        }

        function showTimedLyrics() {
            const timings = [
                0,  3, 9, 13, 16, 19, 20, 21, 22, 23, 24,
                30, 35, 40, 46, 50, 62, 66, 70, 73, 79,
                80, 90, 95, 100, 110, 115, 120, 126, 134,
            ];
            const lyricsLines = document.querySelectorAll('.lyric');

            let currentLine = 0;
            const maxLines = lyricsLines.length;

            clearTimeout(window.showLyricsTimeout);
            clearLyrics(); 

            const showLine = (index) => {
                if (index < maxLines) {
                    lyricsLines[index].style.display = "block"; 

                    setTimeout(() => {
                        lyricsLines[index].style.display = "none"; 
                        showLine(index + 1); 
                    }, (timings[index + 1] - timings[index]) * 1000); 
                }
            }

            showLine(currentLine); 
        }

        function clearLyrics() {
            const lyricsLines = document.querySelectorAll('.lyric');
            lyricsLines.forEach(line => {
                line.style.display = "none"; 
            });
            clearTimeout(window.showLyricsTimeout);
        }
    </script>
</body>
</html>